Version: "0.1"
Environment:
  Name: Zelda
  Observers:
    Sprite2D:
      TileSize: 24
      BackgroundTile: gvgai/newset/floor2.png
  Player:
    AvatarObject: avatar

  Termination:
    Win:
      - eq: [goal:count, 0]
    Lose:
      - eq: [avatar:count, 0]

  Levels:
    - |
      wwwwwwwwwwwww
      w...........w
      w...........w
      w.+...A.....w
      w...........w
      w...........w
      w......2....w
      w.g.........w
      wwwwwwwwwwwww
    - |
      wwwwwwwwwwwww
      w.....+..+g.w
      w.+.w.g.....w
      w....2Ag..2.w
      w+..+.......w
      w....w..+...w
      w.........g.w
      w.2...+++.+ww
      wwwwwwwwwwwww
    - |
      wwwwwwwwwwwwwwwwwwwwwwwwwwwwww
      w........+....2..............w
      w............................w
      w...A.............2..........w
      w............................w
      w....................2.......w
      w..............wwwwwwwwwwwwwww
      w..........................g.w
      wwwwwwwwwwwwwwwwwwwwwwwwwwwwww

Actions:
  # Define action that cannot be controlled by the player.
    # (In this case the spider movement)
  - Name: random_movement
    InputMapping:
      Internal: true
    Behaviours:
      # The gnome and the spider can move into empty space
      - Src:
          Object: spider
          Commands:
            - mov: _dest
            - exec:
                Action: random_movement
                Delay: 5
                Randomize: true
        Dst:
          Object: _empty

      # The spider will not move into the wall, but it needs to keep moving
      - Src:
          Object: spider
          Commands:
            - exec:
                Action: random_movement
                Delay: 5
                Randomize: true
        Dst:
          Object: [wall, key, goal, spider]

      # If the gnome moves into a spider
      - Src:
          Object: spider
        Dst:
          Object: avatar
          Commands:
            - remove: true
            - reward: -1


  # Define the move action
  - Name: move
    Behaviours:
      # agent can move on empty space and keys
      - Src:
          Object: avatar
          Commands:
            - mov: _dest
        Dst:
          Object: _empty

      # Only an avatar with a key can win
      - Src:
          Preconditions:
            - eq: [has_key, 1]
          Object: avatar
          Commands:
            - reward: 1
            - decr: has_key
            - mov: _dest
            - set_tile: 0
        Dst:
          Object: goal
          Commands:
            - remove: true

      - Src:
          Object: avatar
          Commands:
            - mov: _dest
            - eq:
                Arguments: [ has_key, 0 ]
                Commands:
                  - incr: has_key
                  - reward: 1
                  - set_tile: 1
        Dst:
          Object: key
          Commands:
            - eq:
                Arguments: [ src.has_key, 0 ]
                Commands:
                  - remove: true

      # If the gnome moves into a spider
      - Src:
          Object: avatar
          Commands:
            - remove: true
            - reward: -1
        Dst:
          Object: spider


#  - Name: attack
#    InputMapping:
#      Inputs:
#        1:
#          Description: attack front
#          OrientationVector: [ 1, 0 ]
#      Relative: true
#    Behaviours:
#      - Src:
#          Object: avatar
#        Dst:
#          Object: spider
#          Commands:
#            - remove: true

Objects:
  - Name: avatar
    Z: 3
    MapCharacter: A
    Variables:
      - Name: has_key
    Observers:
      Sprite2D:
        - Image: gvgai/oryx/swordman1_0.png
        - Image: gvgai/oryx/swordmankey1_0.png

  - Name: key
    Z: 2
    MapCharacter: "+"
    Observers:
      Sprite2D:
        - Image: gvgai/oryx/key2.png

  - Name: goal
    Z: 2
    MapCharacter: g
    Observers:
      Sprite2D:
        - Image: gvgai/oryx/doorclosed1.png

#   - Name: chaser
#     Z: 2
#     MapCharacter: "3"
#     Observers:
#       Sprite2D:
#         - Image: gvgai/oryx/skeleton1.png

  - Name: spider
    Z: 2
    InitialActions:
      - Action: random_movement
        Delay: 5
        Randomize: true
    MapCharacter: "2"
    Observers:
      Sprite2D:
        - Image: oryx/oryx_fantasy/avatars/spider1.png
      Block2D:
        - Shape: square
          Color: [1.0, 0.0, 0.0]
          Scale: 0.8

  - Name: wall
    MapCharacter: w
    Observers:
      Sprite2D:
        - TilingMode: WALL_16
          Image:
            - gvgai/oryx/wall3_0.png
            - gvgai/oryx/wall3_1.png
            - gvgai/oryx/wall3_2.png
            - gvgai/oryx/wall3_3.png
            - gvgai/oryx/wall3_4.png
            - gvgai/oryx/wall3_5.png
            - gvgai/oryx/wall3_6.png
            - gvgai/oryx/wall3_7.png
            - gvgai/oryx/wall3_8.png
            - gvgai/oryx/wall3_9.png
            - gvgai/oryx/wall3_10.png
            - gvgai/oryx/wall3_11.png
            - gvgai/oryx/wall3_12.png
            - gvgai/oryx/wall3_13.png
            - gvgai/oryx/wall3_14.png
            - gvgai/oryx/wall3_15.png

